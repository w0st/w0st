<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>reveal.js</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<h2>Auto-generated API documentation from RSpec</h2>
					<p>
						Wojciech StÄ™pniak
					</p>
				</section>

				<section>
					<h4>Rspec_api_documentation ?</h4>
					<p>Rspec_api_documentation is a gem which allow you to generate API docs from your test suite</p>
				</section>

				<section>
					<h4>Apitome ?</h4>
					<p>Apitome is a API documentation tool for Rails built on top of the great rspec DSL included in rspec_api_documentation (RAD).
						It's designed to display the documentation generated by RAD in either a single page (with scrollspy),
						or on individual pages, and uses Bootstrap3 for most of the basic styling and highlight.js for code highlighting.</p>
				</section>
				<section>
					<h4> Installation </h4>
					<p> Gemfile:</p>
					<pre><code data-trim class="ruby"  style="font-size: 12px;">
# Documentation
gem "rspec_api_documentation", "~> 5.1.0"
gem "apitome", "~> 0.1.0"
					</code></pre>
					<p>initializers/rspec_api_documentation.rb</p>
					<pre><code data-trim class="ruby"  style="font-size: 12px;">
RspecApiDocumentation.configure do |config|
  # Output folder
  config.docs_dir = Rails.root.join("doc", "api")
  # An array of output format(s).
  # Possible values are :json, :html, :combined_text, :combined_json,
  #   :json_iodocs, :textile, :markdown, :append_json
  config.format = [:json]
end</code></pre>
				</section>
				<section>
				<p>initializers/apitome.rb</p>
				<pre><code data-trim class="ruby"  style="font-size: 12px;">
	Apitome.setup do |config|
	  # This determines where the Apitome routes will be mounted.
	  # Changing this to '/api/documentation' for instance would allow you to browse to
	  # http://localhost:3000/api/documentation to see your api documentation.
	  # Set to nil and mount it yourself if you need to.
	  config.mount_at = nil # I mounted apitome like an engine in Rails router

	  # This defaults to Rails.root if left nil. If you're providing documentation for an engine using
	  # a dummy application it can be useful to set this to your engines root..
	  # E.g. Application::Engine.root
	  config.root = nil

	  # This is where rspec_api_documentation outputs the JSON files.
	  # This is configurable within RAD, and so is configurable here.
	  config.doc_path = "doc/api"

	  # The title of the documentation -- If your project has a name, you'll want to put it here.
	  config.title = "API Documentation"

	  # The main layout view for all documentation pages.
	  # By default this is pretty basic, but you may want to use your own application layout.
	  config.layout = "apitome/application"

	  # We're using highlight.js (https://github.com/isagalaev/highlight.js) for code highlighting,
	  # and it comes with some great themes.
	  # You can check http://softwaremaniacs.org/media/soft/highlight/test.html for themes,
	  # and enter the theme as lowercase/underscore.
	  config.code_theme = "default"

	  # This allows you to override the css manually.
	  # You typically want to require `apitome/application` within the override,
	  # but if you want to override it entirely you can do so.
	  config.css_override = nil

	  # This allows you to override the javascript manually.
	  # You typically want to require `apitome/application` within the override,
	  # but if you want to override it entirely you can do so.
	  config.js_override = nil

	  # You can provide a 'README' style markdown file for the documentation,
	  # which is a useful place to include general information.
	  # This path is relative to your doc_path configuration.
	  config.readme = "../api.md"

	  # Apitome can render the documentation into a single page that uses scrollspy,
	  # or it can render the documentation on individual pages on demand.
	  # This allows you to specify which one you want, as a single page may impact performance.
	  config.single_page = true
	end
</code></pre>
</section>
				<section>
					<h4> Example Controller </h4>

					<pre><code data-trim class="ruby" contenteditable style="font-size: 18px;">
class UsersController < Api::V1::Controllers::ApiController
  def show
    render json: current_user.slice(:id, :email, :role)
  end
end
					</code></pre>
				</section>

				<section>
					<h4> Example Spec </h4>

					<pre><code data-trim class="ruby"  style="font-size: 18px;">
require "rails_helper"
require "rspec_api_documentation/dsl"

  resource "[V1][Users] Users" do
    get "/client/api/v1/user" do
      header "Content-Type", "application/json"
      header "Authorization", "Bearer #{access_token.token}"

      context "when token is valid" do
        let(:user) { create(:user, :with_expert) }
        let(:access_token) { create(:access_token, resource_owner_id: user.id) }

        example_request "Get user's profile" do
          expect(status).to eq(200)
        end
     end
  end
end
					</code></pre>


				</section>

				<section>
					<h4>Let's generate</h4>
					<pre><code data-trim class="bash">rake docs:generate</code></pre>
				</section>

				<section>
					<h4>Let's generate</h4>
					<p><img data-src="img/terminal-operator.jpg" /></p>
				</section>

				<section>
					<img data-src="img/example-doc.png">

				</section>

				<section>
					<h4>Behind the scene</h4>
					<ul>
						<li class="fragment">RSpec Formatters</li>
						<li class="fragment">RSpec metadata</li>
						<li class="fragment">Custom DSL</li>
					</ul>
				</section>

				<section>

					<h4>Let's generate</h4>
					<pre><code data-trim class="bash">rake docs:generate</code></pre>
					<pre><code data-trim class="bash" style="font-size: 18px;">rspec --pattern spec/acceptance/\*\*/\*_spec.rb --format RspecApiDocumentation::ApiFormatter</code></pre><br />
					<a href="https://relishapp.com/rspec/rspec-core/docs/formatters/custom-formatters">Rspec custom formatters</a><br />
					<a href="https://ieftimov.com/how-to-write-rspec-formatters-from-scratch">How to write rspec formatters from scratch</a>
					<a href="https://github.com/zipmark/rspec_api_documentation/blob/master/lib/rspec_api_documentation/api_formatter.rb">rspec_api_documentation</a>
				</section>

				<section>
					<h4> User-defined metadata in Rspec </h4>

					<pre><code data-trim class="ruby" contenteditable style="font-size: 18px;">
						describe "Define group metadata using a hash", foo: 2 do
							it "has access to the metadata in the example" do |example|
								expect(example.metadata[:foo]).to eq(2)
							end
						end
					</code></pre>
					</p>
				</section>

				<section>
					<h4>RSpec DSL</h4>
					<ul>
						<li>Rspec provides an API for extending its DSL</li>
					</ul>
					<a href="https://www.slideshare.net/SmartLogic/rspec-api-documentation#12">Nice presentation about that</a>
				</section>
				<section>
					<p>More examples (including PUT with parameters)...</p>

				</section>
				<section>
					<p> Thanks </p>
				</section>
			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
		</script>
	</body>
</html>
